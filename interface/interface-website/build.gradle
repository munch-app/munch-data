ext.dockerTag = dockerRegistryUrl + rootProject.name + '/' + project.name + ':'

task buildImage {
  doLast {
    exec { commandLine "docker", "build", "-t", dockerTag + dockerRegistryVersion, '.' }
  }
}
task publishDocker {
  dependsOn 'buildImage'

  doLast {
    exec { commandLine "docker", "push", dockerTag + dockerRegistryVersion }
  }
}

task buildLocal {
  doLast {
    exec { commandLine "docker", "build", "-f", "Dockerfile.local", "-t", dockerTag + 'local', '.' }
  }
}

task publishInterfaceWebsite {
  doLast {
    exec {
      commandLine "docker", "build", "-t", 
        dockerTag + dockerRegistryVersion, '.'
    }
    exec { commandLine "docker", "push", dockerTag + dockerRegistryVersion }
    exec { commandLine 'aws', 'ecs', 'update-service',
      '--cluster', 'munch-core',
      '--service', 'MunchData_InterfaceWebsite',
      '--force-new-deployment'
    }
  }
}
